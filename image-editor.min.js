!function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(a)return a(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[r]={exports:{}};e[r][0].call(h.exports,function(t){var n=e[r][1][t];return o(n?n:t)},h,h.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,n){tui.util.defineNamespace("tui.component.ImageEditor",t("./src/js/imageEditor"),!0)},{"./src/js/imageEditor":9}],2:[function(t,e,n){"use strict";var i=t("../interface/component"),o=t("../extension/cropzone"),a=t("../consts"),r=t("../util"),s=10,c=Math.abs,u=r.clamp,h=tui.util.defineClass(i,{init:function(t){this.setParent(t),this._cropzone=null,this._startX=null,this._startY=null,this._listeners={mousedown:$.proxy(this._onFabricMouseDown,this),mousemove:$.proxy(this._onFabricMouseMove,this),mouseup:$.proxy(this._onFabricMouseUp,this)}},name:a.componentNames.CROPPER,start:function(){var t;this._cropzone||(this._cropzone=new o({left:-10,top:-10,width:1,height:1,cornerSize:10,cornerColor:"black",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0}),t=this.getCanvas(),t.add(this._cropzone),t.on("mouse:down",this._listeners.mousedown),t.defaultCursor="crosshair")},end:function(t){var e,n=this.getCanvas(),i=this._cropzone;return i?(n.selection=!0,n.defaultCursor="default",n.discardActiveObject(),n.off("mouse:down",this._listeners.mousedown),i.remove(),t&&(e=this._getCroppedImageData()),this._cropzone=null,e):null},_onFabricMouseDown:function(t){var e,n=this.getCanvas();t.target||(n.selection=!1,e=n.getPointer(t.e),this._startX=e.x,this._startY=e.y,n.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup}))},_onFabricMouseMove:function(t){var e=this.getCanvas(),n=e.getPointer(t.e),i=n.x,o=n.y,a=this._cropzone;c(i-this._startX)+c(o-this._startY)>s&&(a.remove(),a.set(this._calcRectDimensionFromPoint(i,o)),e.add(a))},_calcRectDimensionFromPoint:function(t,e){var n=this.getCanvas(),i=n.getWidth(),o=n.getHeight(),a=this._startX,r=this._startY,s=u(t,0,a),c=u(e,0,r);return{left:s,top:c,width:u(t,a,i)-s,height:u(e,r,o)-c}},_onFabricMouseUp:function(){var t=this._cropzone,e=this._listeners,n=this.getCanvas();n.setActiveObject(t),n.off({"mouse:move":e.mousemove,"mouse:up":e.mouseup})},_getCroppedImageData:function(){var t,e=this._cropzone;return e.isValid()?(t={left:e.getLeft(),top:e.getTop(),width:e.getWidth(),height:e.getHeight()},{imageName:this.getImageName(),url:this.getCanvas().toDataURL(t)}):null}});e.exports=h},{"../consts":5,"../extension/cropzone":6,"../interface/component":11,"../util":13}],3:[function(t,e,n){"use strict";var i=t("../interface/component"),o=t("../consts"),a={crossOrigin:""},r={cssOnly:!0},s={backstoreOnly:!0},c=tui.util.defineClass(i,{init:function(t){this.setParent(t)},name:o.componentNames.IMAGE_LOADER,load:function(t,e){var n,i,o=this;return t||e?n=this._setBackgroundImage(e).done(function(e){o._onSuccessImageLoad(e),o.setCanvasImage(t,e)}):(i=this.getCanvas(),i.backgroundImage=null,i.renderAll(),n=$.Deferred(function(){o.setCanvasImage("",null)}).resolve()),n},_setBackgroundImage:function(t){var e,n=$.Deferred();return t?(e=this.getCanvas(),e.setBackgroundImage(t,function(){var t=e.backgroundImage;t.getElement()?n.resolve(t):n.reject()},a),n):n.reject()},_onSuccessImageLoad:function(t){var e=this.getCanvas(),n=Math.min(Math.floor(1e3),t.width);e.setDimensions({margin:"auto",width:"100%",height:"","max-width":n+"px"},r),e.setDimensions({width:t.width,height:t.height},s)}});e.exports=c},{"../consts":5,"../interface/component":11}],4:[function(t,e,n){"use strict";var i=t("../interface/component"),o=t("../consts"),a=tui.util.defineClass(i,{init:function(){this.canvas=null,this.oImage=null,this.imageName=""},name:o.componentNames.MAIN,toDataURL:function(t){return this.canvas&&this.canvas.toDataURL(t)},setCanvasImage:function(t,e){this.imageName=t,this.oImage=e},setCanvasElement:function(t){this.canvas=new fabric.Canvas($(t)[0],{containerClass:"tui-component-imageEditor-canvasContainer"})},getCanvasElement:function(){return this.canvas.getElement()},getCanvas:function(){return this.canvas},getCanvasImage:function(){return this.oImage},getImageName:function(){return this.imageName}});e.exports=a},{"../consts":5,"../interface/component":11}],5:[function(t,e,n){"use strict";var i=t("./util");e.exports={componentNames:i.keyMirror("MAIN","IMAGE_LOADER","CROPPER"),commandNames:i.keyMirror("LOAD_IMAGE"),eventNames:{LOAD_IMAGE:"loadImage",CLEAR_IMAGE:"clearImage",START_CROPPING:"startCropping",END_CROPPING:"endCropping",EMPTY_REDO_STACK:"emptyRedoStack",EMPTY_UNDO_STACK:"emptyUndoStack",PUSH_UNDO_STACK:"pushUndoStack",PUSH_REDO_STACK:"pushRedoStack"},IS_SUPPORT_FILE_API:!!(window.File&&window.FileList&&window.FileReader)}},{"./util":13}],6:[function(t,e,n){"use strict";var i=t("../util").clamp,o="tl",a="tr",r="mt",s="ml",c="mr",u="mb",h="bl",l="br",m=fabric.util.createClass(fabric.Rect,{initialize:function(t){this.callSuper("initialize",t),this.on({moving:this._onMoving,scaling:this._onScaling})},_render:function(t){var e,n,i,o,a=7,r=7;this.callSuper("_render",t),e=this.flipX?-1:1,n=this.flipY?-1:1,i=e/this.scaleX,o=n/this.scaleY,t.scale(i,o),this._fillOuterRect(t,"rgba(0, 0, 0, 0.55)"),this._strokeBorder(t,"rgb(0, 0, 0)",a),this._strokeBorder(t,"rgb(255, 255, 255)",a,r),t.scale(1/i,1/o)},_fillOuterRect:function(t,e){var n=this._getCoordinates(t),i=n.x,o=n.y;t.save(),t.fillStyle=e,t.beginPath(),t.moveTo(i[0]-1,o[0]-1),t.lineTo(i[3]+1,o[0]-1),t.lineTo(i[3]+1,o[3]+1),t.lineTo(i[0]-1,o[3]-1),t.lineTo(i[0]-1,o[0]-1),t.closePath(),t.moveTo(i[1],o[1]),t.lineTo(i[1],o[2]),t.lineTo(i[2],o[2]),t.lineTo(i[2],o[1]),t.lineTo(i[1],o[1]),t.closePath(),t.fill(),t.restore()},_getCoordinates:function(t){var e=Math.ceil,n=this.getWidth(),i=this.getHeight(),o=n/2,a=i/2,r=this.getLeft(),s=this.getTop(),c=t.canvas;return{x:tui.util.map([-(o+r),-o,o,o+(c.width-r-n)],e),y:tui.util.map([-(a+s),-a,a,a+(c.height-s-i)],e)}},_strokeBorder:function(t,e,n,i){var o=this.getWidth()/2,a=this.getHeight()/2;t.save(),t.strokeStyle=e,t.setLineDash&&t.setLineDash([n,n]),i&&(t.lineDashOffset=i),t.beginPath(),t.moveTo(-o,-a),t.lineTo(o,-a),t.lineTo(o,a),t.lineTo(-o,a),t.lineTo(-o,-a),t.stroke(),t.restore()},_onMoving:function(){var t=this.canvas,e=this.getLeft(),n=this.getTop(),o=this.getWidth(),a=this.getHeight(),r=t.getWidth()-o,s=t.getHeight()-a;this.setLeft(i(e,0,r)),this.setTop(i(n,0,s))},_onScaling:function(t){var e=this.canvas.getPointer(t.e),n=this._calcScalingSizeFromPointer(e);this.scale(1).set(n)},_calcScalingSizeFromPointer:function(t){var e=t.x,n=t.y,i=this._calcTopLeftScalingSizeFromPointer(e,n),o=this._calcBottomRightScalingSizeFromPointer(e,n);return this._makeScalingSettings(i,o)},_calcTopLeftScalingSizeFromPointer:function(t,e){var n=this.getHeight()+this.top,o=this.getWidth()+this.left,a=i(e,0,n-1),r=i(t,0,o-1);return{top:a,left:r,width:o-r,height:n-a}},_calcBottomRightScalingSizeFromPointer:function(t,e){var n=this.canvas,o=n.width,a=n.height,r=this.left,s=this.top;return{width:i(t,r+1,o)-r,height:i(e,s+1,a)-s}},_makeScalingSettings:function(t,e){var n,i=t.width,m=t.height,g=e.height,f=e.width,d=t.left,p=t.top;switch(this.__corner){case o:n=t;break;case a:n={width:f,height:m,top:p};break;case h:n={width:i,height:g,left:d};break;case l:n=e;break;case s:n={width:i,left:d};break;case r:n={height:m,top:p};break;case c:n={width:f};break;case u:n={height:g}}return n},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0}});e.exports=m},{"../util":13}],7:[function(t,e,n){"use strict";function i(t,e){return new a({execute:function(n){var i=n[u];return this.store={prevName:i.getImageName(),prevImage:i.getCanvasImage()},i.load(t,e)},undo:function(t){var e=t[u],n=this.store;return e.load(n.prevName,n.prevImage)}})}function o(t,e){return e=Array.prototype.slice.call(arguments,1),h[t].apply(null,e)}var a=t("../interface/command"),r=t("../consts"),s=r.componentNames,c=r.commandNames,u=s.IMAGE_LOADER,h={};h[c.LOAD_IMAGE]=i,e.exports={create:o}},{"../consts":5,"../interface/command":10}],8:[function(t,e,n){"use strict";var i=t("../util").keyMirror,o=i("UN_IMPLEMENTATION","NO_COMPONENT_NAME","UNKNOWN"),a={UN_IMPLEMENTATION:"Should implement a method: ",NO_COMPONENT_NAME:"Should set a component name",UNKNOWN:"Unknown: "},r={UN_IMPLEMENTATION:function(t){return a.UN_IMPLEMENTATION+t},NO_COMPONENT_NAME:function(){return a.NO_COMPONENT_NAME},UNKNOWN:function(t){return a.UNKNOWN+t}};e.exports={types:tui.util.extend({},o),create:function(t){var e;return t=t.toLowerCase(),e=r[t]||r.unknown,Array.prototype.shift.apply(arguments),e.apply(null,arguments)}}},{"../util":13}],9:[function(t,e,n){"use strict";var i=t("./invoker"),o=t("./factory/command"),a=t("./consts"),r=a.eventNames,s=a.commandNames,c=a.componentNames,u=tui.util.defineClass({init:function(t){this._invoker=new i,this._setCanvasElement($(t)[0])},getEventNames:function(){return tui.util.extend({},r)},_setCanvasElement:function(t){this._getMainComponent().setCanvasElement(t)},_getMainComponent:function(){return this._invoker.getComponent(c.MAIN)},clear:function(){this.endCropping()},execute:function(t){var e=this;this.clear(),this._invoker.invoke(t).done(function(){e.fire(r.PUSH_UNDO_STACK),e.fire(r.EMPTY_REDO_STACK)})},undo:function(){var t=this._invoker,e=this;this.clear(),t.undo().done(function(){t.isEmptyUndoStack()&&e.fire(r.EMPTY_UNDO_STACK),e.fire(r.PUSH_REDO_STACK)})},redo:function(){var t=this._invoker,e=this;this.clear(),t.redo().done(function(){t.isEmptyRedoStack()&&e.fire(r.EMPTY_REDO_STACK),e.fire(r.PUSH_UNDO_STACK)})},loadImageFromFile:function(t){t&&this.loadImageFromURL(t.name,URL.createObjectURL(t))},loadImageFromURL:function(t,e){var n,i,a=this;t&&e&&(n=$.proxy(this._callbackAfterImageLoading,this),i=o.create(s.LOAD_IMAGE,t,e).setExecuteCallback(n).setUndoCallback(function(t){t&&n(t),a.fire(r.CLEAR_IMAGE)}),this.execute(i))},_callbackAfterImageLoading:function(t){var e=this._getMainComponent(),n=$(e.getCanvasElement());this.fire(r.LOAD_IMAGE,{originalWidth:t.width,originalHeight:t.height,currentWidth:n.width(),currentHeight:n.height()})},startCropping:function(){var t=this._invoker.getComponent(c.CROPPER);t.start(),this.fire(r.START_CROPPING)},endCropping:function(t){var e=this._invoker.getComponent(c.CROPPER),n=e.end(t);this.fire(r.END_CROPPING),n&&this.loadImageFromURL(n.imageName,n.url)},toDataURL:function(t){return this._getMainComponent().toDataURL(t)},getImageName:function(){return this._getMainComponent().getImageName()},clearUndoStack:function(){this._invoker.clearUndoStack(),this.fire(r.EMPTY_UNDO_STACK)},clearRedoStack:function(){this._invoker.clearRedoStack(),this.fire(r.EMPTY_REDO_STACK)}});tui.util.CustomEvents.mixin(u),e.exports=u},{"./consts":5,"./factory/command":7,"./invoker":12}],10:[function(t,e,n){"use strict";var i=t("../factory/errorMessage"),o=i.create,a=i.types,r=tui.util.defineClass({init:function(t){this.execute=t.execute,this.undo=t.undo,this.executionCallback=null,this.undoerCallback=null},execute:function(){throw new Error(o(a.UN_IMPLEMENTATION,"execute"))},undo:function(){throw new Error(o(a.UN_IMPLEMENTATION,"undo"))},setExecuteCallback:function(t){return this.executionCallback=t,this},setUndoCallback:function(t){return this.undoerCallback=t,this}});e.exports=r},{"../factory/errorMessage":8}],11:[function(t,e,n){"use strict";var i=tui.util.defineClass({init:function(){},setCanvasImage:function(t,e){this.getRoot().setCanvasImage(t,e)},getCanvasElement:function(){return this.getRoot().getCanvasElement()},getCanvas:function(){return this.getRoot().getCanvas()},getCanvasImage:function(){return this.getRoot().getCanvasImage()},getImageName:function(){return this.getRoot().getImageName()},getEditor:function(){return this.getRoot().getEditor()},getName:function(){return this.name},setParent:function(t){this._parent=t||null},getParent:function(){return this._parent},getRoot:function(){for(var t=this.getParent(),e=this;t;)e=t,t=e.getParent();return e}});e.exports=i},{}],12:[function(t,e,n){"use strict";var i=t("./component/imageLoader"),o=t("./component/cropper"),a=t("./component/main"),r=tui.util.defineClass({init:function(){this.undoStack=[],this.redoStack=[],this.componentMap={},this._createComponents()},_createComponents:function(){var t=new a;this._register(t),this._register(new i(t)),this._register(new o(t))},_register:function(t){this.componentMap[t.getName()]=t},getComponent:function(t){return this.componentMap[t]},invoke:function(t){var e=this;return $.when(t.execute(this.componentMap)).done(t.executeCallback).done(function(){e.undoStack.push(t),e.clearRedoStack()})},undo:function(){var t,e=this.undoStack.pop(),n=this;return t=e?$.when(e.undo(this.componentMap)).done(e.undoCallback).done(function(){n.redoStack.push(e)}):$.Deferred().reject()},redo:function(){var t,e=this.redoStack.pop(),n=this;return t=e?$.when(e.execute(this.componentMap)).done(e.executeCallback).done(function(){n.undoStack.push(e)}):$.Deferred().reject()},isEmptyRedoStack:function(){return 0===this.redoStack.length},isEmptyUndoStack:function(){return 0===this.undoStack.length},clearUndoStack:function(){this.undoStack=[]},clearRedoStack:function(){this.redoStack=[]}});e.exports=r},{"./component/cropper":2,"./component/imageLoader":3,"./component/main":4}],13:[function(t,e,n){"use strict";var i=Math.min,o=Math.max;e.exports={clamp:function(t,e,n){var a;return e>n&&(a=e,e=n,n=a),o(e,i(t,n))},keyMirror:function(){var t={};return tui.util.forEach(arguments,function(e){t[e]=e}),t}}},{}]},{},[1]);