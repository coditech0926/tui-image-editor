/*!
 * tui-image-editor.min.js
 * @version 1.4.1
 * @author NHNEnt FE Development Lab <dl_javascript@nhnent.com>
 * @license MIT
 */
!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="dist",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(52),o=i(r);tui.util.defineNamespace("tui.component.ImageEditor",o.default,!0)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(8),o=i(r);e.exports={componentNames:o.default.keyMirror("MAIN","IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE"),commandNames:o.default.keyMirror("CLEAR","LOAD_IMAGE","FLIP_IMAGE","ROTATE_IMAGE","ADD_OBJECT","REMOVE_OBJECT","APPLY_FILTER"),eventNames:{LOAD_IMAGE:"loadImage",CLEAR_OBJECTS:"clearObjects",CLEAR_IMAGE:"clearImage",START_CROPPING:"startCropping",END_CROPPING:"endCropping",FLIP_IMAGE:"flipImage",ROTATE_IMAGE:"rotateImage",ADD_OBJECT:"addObject",SELECT_OBJECT:"selectObject",REMOVE_OBJECT:"removeObject",ADJUST_OBJECT:"adjustObject",START_FREE_DRAWING:"startFreeDrawing",END_FREE_DRAWING:"endFreeDrawing",START_LINE_DRAWING:"startLineDrawing",END_LINE_DRAWING:"endLineDrawing",EMPTY_REDO_STACK:"emptyRedoStack",EMPTY_UNDO_STACK:"emptyUndoStack",PUSH_UNDO_STACK:"pushUndoStack",PUSH_REDO_STACK:"pushRedoStack",ACTIVATE_TEXT:"activateText",APPLY_FILTER:"applyFilter",EDIT_TEXT:"editText",MOUSE_DOWN:"mousedown"},states:o.default.keyMirror("NORMAL","CROP","FREE_DRAWING","LINE","TEXT","SHAPE"),keyCodes:{Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},fObjectOptions:{SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},rejectMessages:{flip:"The flipX and flipY setting values are not changed.",rotation:"The current angle is same the old angle.",loadImage:"The background image is empty.",isLock:"The executing command state is locked.",undo:"The promise of undo command is reject.",redo:"The promise of redo command is reject."}}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){n(this,e)}return i(e,[{key:"setCanvasImage",value:function(e,t){this.getRoot().setCanvasImage(e,t)}},{key:"getCanvasElement",value:function(){return this.getRoot().getCanvasElement()}},{key:"getCanvas",value:function(){return this.getRoot().getCanvas()}},{key:"getCanvasImage",value:function(){return this.getRoot().getCanvasImage()}},{key:"getImageName",value:function(){return this.getRoot().getImageName()}},{key:"getEditor",value:function(){return this.getRoot().getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(e,t){this.getRoot().setImageProperties(e,t)}},{key:"setCanvasCssDimension",value:function(e){this.getRoot().setCanvasCssDimension(e)}},{key:"setCanvasBackstoreDimension",value:function(e){this.getRoot().setCanvasBackstoreDimension(e)}},{key:"setParent",value:function(e){this._parent=e||null}},{key:"adjustCanvasDimension",value:function(){this.getRoot().adjustCanvasDimension()}},{key:"getParent",value:function(){return this._parent}},{key:"getRoot",value:function(){for(var e=this.getParent(),t=this;e;)t=e,e=t.getParent();return t}}]),e}();e.exports=r},function(e,t,n){var i=n(32)("wks"),r=n(35),o=n(4).Symbol,a="function"==typeof o,s=e.exports=function(e){return i[e]||(i[e]=a&&o[e]||(a?o:r)("Symbol."+e))};s.store=i},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){n(83),n(85),n(86),n(84),e.exports=n(9).Promise},function(e,t,n){var i=n(15);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var i=n(16),r=n(31);e.exports=n(10)?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){"use strict";var n=Math.min,i=Math.max;e.exports={clamp:function(e,t,r){var o=void 0;return t>r&&(o=t,t=r,r=o),i(t,n(e,r))},keyMirror:function(){for(var e={},t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return tui.util.forEach(n,function(t){e[t]=t}),e},makeStyleText:function(e){var t="";return tui.util.forEach(e,function(e,n){t+=n+": "+e+";"}),t}}},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){e.exports=!n(27)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports={}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(17);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var i=n(6),r=n(59),o=n(80),a=Object.defineProperty;t.f=n(10)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),r)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var i=n(15),r=n(4).document,o=i(r)&&i(r.createElement);e.exports=function(e){return o?r.createElement(e):{}}},function(e,t,n){var i=n(16).f,r=n(14),o=n(3)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},function(e,t,n){var i=n(32)("keys"),r=n(35);e.exports=function(e){return i[e]||(i[e]=r(e))}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,n){var i=n(61),r=n(18);e.exports=function(e){return i(r(e))}},function(e,t,n){var i=n(12),r=n(3)("toStringTag"),o="Arguments"==i(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=a(t=Object(e),r))?n:o?i(t):"Object"==(s=i(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var i=n(4),r=n(9),o=n(13),a=n(7),s="prototype",u=function(e,t,n){var c,l,f,h=e&u.F,d=e&u.G,v=e&u.S,p=e&u.P,_=e&u.B,g=e&u.W,y=d?r:r[t]||(r[t]={}),m=y[s],b=d?i:v?i[t]:(i[t]||{})[s];d&&(n=t);for(c in n)l=!h&&b&&void 0!==b[c],l&&c in y||(f=l?b[c]:n[c],y[c]=d&&"function"!=typeof b[c]?n[c]:_&&l?o(f,i):g&&b[c]==f?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t[s]=e[s],t}(f):p&&"function"==typeof f?o(Function.call,f):f,p&&((y.virtual||(y.virtual={}))[c]=f,e&u.R&&m&&!m[c]&&a(m,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){e.exports=n(4).document&&document.documentElement},function(e,t,n){"use strict";var i=n(30),r=n(26),o=n(74),a=n(7),s=n(14),u=n(11),c=n(64),l=n(20),f=n(70),h=n(3)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",p="keys",_="values",g=function(){return this};e.exports=function(e,t,n,y,m,b,k){c(n,t,y);var C,O,E,w=function(e){if(!d&&e in j)return j[e];switch(e){case p:return function(){return new n(this,e)};case _:return function(){return new n(this,e)}}return function(){return new n(this,e)}},T=t+" Iterator",S=m==_,x=!1,j=e.prototype,P=j[h]||j[v]||m&&j[m],A=P||w(m),M=m?S?w("entries"):A:void 0,I="Array"==t?j.entries||P:P;if(I&&(E=f(I.call(new e)),E!==Object.prototype&&(l(E,T,!0),i||s(E,h)||a(E,h,g))),S&&P&&P.name!==_&&(x=!0,A=function(){return P.call(this)}),i&&!k||!d&&!x&&j[h]||a(j,h,A),u[t]=A,u[T]=g,m)if(C={values:S?A:w(_),keys:b?A:w(p),entries:M},k)for(O in C)O in j||o(j,O,C[O]);else r(r.P+r.F*(d||x),t,C);return C}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(4),r="__core-js_shared__",o=i[r]||(i[r]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,n){var i,r,o,a=n(13),s=n(60),u=n(28),c=n(19),l=n(4),f=l.process,h=l.setImmediate,d=l.clearImmediate,v=l.MessageChannel,p=0,_={},g="onreadystatechange",y=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},m=function(e){y.call(e.data)};h&&d||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return _[++p]=function(){s("function"==typeof e?e:Function(e),t)},i(p),p},d=function(e){delete _[e]},"process"==n(12)(f)?i=function(e){f.nextTick(a(y,e,1))}:v?(r=new v,o=r.port2,r.port1.onmessage=m,i=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(i=function(e){l.postMessage(e+"","*")},l.addEventListener("message",m,!1)):i=g in c("script")?function(e){u.appendChild(c("script"))[g]=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:h,clear:d}},function(e,t,n){var i=n(22),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(47),f=i(l),h=n(1),d=i(h),v=n(8),p=i(v),_=10,g=Math.abs,y=p.default.clamp,m=d.default.keyCodes,b=tui.util.bind,k=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=d.default.componentNames.CROPPER,n._cropzone=null,n._startX=null,n._startY=null,n._withShiftKey=!1,n._listeners={keydown:b(n._onKeyDown,n),keyup:b(n._onKeyUp,n),mousedown:b(n._onFabricMouseDown,n),mousemove:b(n._onFabricMouseMove,n),mouseup:b(n._onFabricMouseUp,n)},n}return a(t,e),s(t,[{key:"start",value:function(){if(!this._cropzone){var e=this.getCanvas();e.forEachObject(function(e){e.evented=!1}),this._cropzone=new f.default({left:-10,top:-10,width:1,height:1,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0}),e.deactivateAll(),e.add(this._cropzone),e.on("mouse:down",this._listeners.mousedown),e.selection=!1,e.defaultCursor="crosshair",fabric.util.addListener(document,"keydown",this._listeners.keydown),fabric.util.addListener(document,"keyup",this._listeners.keyup)}}},{key:"end",value:function(e){var t=this.getCanvas(),n=this._cropzone,i=void 0;return n?(n.remove(),t.selection=!0,t.defaultCursor="default",t.off("mouse:down",this._listeners.mousedown),t.forEachObject(function(e){e.evented=!0}),e&&(i=this._getCroppedImageData()),this._cropzone=null,fabric.util.removeListener(document,"keydown",this._listeners.keydown),fabric.util.removeListener(document,"keyup",this._listeners.keyup),i):null}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas();if(!e.target){t.selection=!1;var n=t.getPointer(e.e);this._startX=n.x,this._startY=n.y,t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),i=n.x,r=n.y,o=this._cropzone;g(i-this._startX)+g(r-this._startY)>_&&(o.remove(),o.set(this._calcRectDimensionFromPoint(i,r)),t.add(o))}},{key:"_calcRectDimensionFromPoint",value:function(e,t){var n=this.getCanvas(),i=n.getWidth(),r=n.getHeight(),o=this._startX,a=this._startY,s=y(e,0,o),u=y(t,0,a),c=y(e,o,i)-s,l=y(t,a,r)-u;return this._withShiftKey&&(c>l?l=c:l>c&&(c=l),o>=e&&(s=o-c),a>=t&&(u=a-l)),{left:s,top:u,width:c,height:l}}},{key:"_onFabricMouseUp",value:function(){var e=this._cropzone,t=this._listeners,n=this.getCanvas();n.setActiveObject(e),n.off({"mouse:move":t.mousemove,"mouse:up":t.mouseup})}},{key:"_getCroppedImageData",value:function(){var e=this._cropzone;if(!e.isValid())return null;var t={left:e.getLeft(),top:e.getTop(),width:e.getWidth(),height:e.getHeight()};return{imageName:this.getImageName(),url:this.getCanvas().toDataURL(t)}}},{key:"_onKeyDown",value:function(e){e.keyCode===m.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(e){e.keyCode===m.SHIFT&&(this._withShiftKey=!1)}}]),t}(c.default);e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(5),c=i(u),l=n(2),f=i(l),h=n(48),d=i(h),v=n(1),p=i(v),_=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=p.default.componentNames.FILTER,n}return a(t,e),s(t,[{key:"add",value:function(e,t){var n=this;return new c.default(function(i,r){var o=n._createFilter(e,t),a=n._getSourceImage(),s=n.getCanvas();o||r(),a.filters.push(o),n._apply(a,function(){s.renderAll(),i({type:e,action:"add"})})})}},{key:"remove",value:function(e){var t=this;return new c.default(function(n,i){var r=t._getSourceImage(),o=t.getCanvas();r.filters.length||i(),r.filters.pop(),t._apply(r,function(){o.renderAll(),n({type:e,atction:"remove"})})})}},{key:"_apply",value:function(e,t){e.applyFilters(t)}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(e,t){var n=void 0;switch(e){case"mask":n=new d.default(t);break;case"removeWhite":n=new fabric.Image.filters.RemoveWhite(t);break;default:n=null}return n}}]),t}(f.default);e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(5),c=i(u),l=n(2),f=i(l),h=n(1),d=i(h),v=d.default.componentNames,p=d.default.rejectMessages,_=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=v.FLIP,n}return a(t,e),s(t,[{key:"getCurrentSetting",value:function(){var e=this.getCanvasImage();return{flipX:e.flipX,flipY:e.flipY}}},{key:"set",value:function(e){var t=this.getCurrentSetting(),n=t.flipX!==e.flipX,i=t.flipY!==e.flipY;return n||i?(tui.util.extend(t,e),this.setImageProperties(t,!0),this._invertAngle(n,i),this._flipObjects(n,i),c.default.resolve({setting:t,angle:this.getCanvasImage().angle})):c.default.reject(p.flip)}},{key:"_invertAngle",value:function(e,t){var n=this.getCanvasImage(),i=n.angle;e&&(i*=-1),t&&(i*=-1),n.setAngle(parseFloat(i)).setCoords()}},{key:"_flipObjects",value:function(e,t){var n=this.getCanvas();e&&n.forEachObject(function(e){e.set({angle:parseFloat(e.angle*-1),flipX:!e.flipX,left:n.width-e.left}).setCoords()}),t&&n.forEachObject(function(e){e.set({angle:parseFloat(e.angle*-1),flipY:!e.flipY,top:n.height-e.top}).setCoords()}),n.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var e=this.getCurrentSetting();return this.set({flipX:!e.flipX,flipY:e.flipY})}},{key:"flipY",value:function(){var e=this.getCurrentSetting();return this.set({flipX:e.flipX,flipY:!e.flipY})}}]),t}(f.default);e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=f.default.componentNames.FREE_DRAWING,n.width=12,n.oColor=new fabric.Color("rgba(0, 0, 0, 0.5)"),n}return a(t,e),s(t,[{key:"start",value:function(e){var t=this.getCanvas();t.isDrawingMode=!0,this.setBrush(e)}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;e=e||{},this.width=e.width||this.width,e.color&&(this.oColor=new fabric.Color(e.color)),t.width=this.width,t.color=this.oColor.toRgba()}},{key:"end",value:function(){var e=this.getCanvas();e.isDrawingMode=!1}}]),t}(c.default);e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h={arrow:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},d=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=f.default.componentNames.ICON,n._oColor="#000000",n._pathMap=h,n}return a(t,e),s(t,[{key:"add",value:function(e,t){var n=this.getCanvas(),i=this._pathMap[e],r=f.default.fObjectOptions.SELECTION_STYLE;if(i){var o=this._createIcon(i);o.set(tui.util.extend({type:"icon",fill:this._oColor},r,t)),n.add(o).setActiveObject(o)}}},{key:"registerPaths",value:function(e){var t=this;tui.util.forEach(e,function(e,n){t._pathMap[n]=e},this)}},{key:"setColor",value:function(e,t){this._oColor=e,t&&"icon"===t.get("type")&&(t.setFill(this._oColor),this.getCanvas().renderAll())}},{key:"_createIcon",value:function(e){return new fabric.Path(e)}}]),t}(c.default);e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(5),c=i(u),l=n(2),f=i(l),h=n(1),d=i(h),v=d.default.componentNames,p=d.default.rejectMessages,_={padding:0,crossOrigin:"anonymous"},g=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=v.IMAGE_LOADER,n}return a(t,e),s(t,[{key:"load",value:function(e,t){var n=this,i=void 0;if(e||t)i=this._setBackgroundImage(t).then(function(t){return n.setCanvasImage(e,t),n.adjustCanvasDimension(),t});else{var r=this.getCanvas();r.backgroundImage=null,r.renderAll(),i=new c.default(function(e){n.setCanvasImage("",null),e()})}return i}},{key:"_setBackgroundImage",value:function(e){var t=this;return e?new c.default(function(n,i){var r=t.getCanvas();r.setBackgroundImage(e,function(){var e=r.backgroundImage;e.getElement()?n(e):i()},_)}):c.default.reject(p.loadImage)}}]),t}(f.default);e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h=tui.util.bind,d=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=f.default.componentNames.LINE,n._width=12,n._oColor=new fabric.Color("rgba(0, 0, 0, 0.5)"),n._listeners={mousedown:h(n._onFabricMouseDown,n),mousemove:h(n._onFabricMouseMove,n),mouseup:h(n._onFabricMouseUp,n)},n}return a(t,e),s(t,[{key:"start",value:function(e){var t=this.getCanvas();t.defaultCursor="crosshair",t.selection=!1,this.setBrush(e),t.forEachObject(function(e){e.set({evented:!1})}),t.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;e=e||{},this._width=e.width||this._width,e.color&&(this._oColor=new fabric.Color(e.color)),t.width=this._width,t.color=this._oColor.toRgba()}},{key:"end",value:function(){var e=this.getCanvas();e.defaultCursor="default",e.selection=!0,e.forEachObject(function(e){e.set({evented:!0})}),e.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),i=[n.x,n.y,n.x,n.y];this._line=new fabric.Line(i,{stroke:this._oColor.toRgba(),strokeWidth:this._width,evented:!1}),this._line.set(f.default.fObjectOptions.SELECTION_STYLE),t.add(this._line),t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e);this._line.set({x2:n.x,y2:n.y}),this._line.setCoords(),t.renderAll()}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas();this._line=null,e.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}]),t}(c.default);e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h=1e3,d=800,v={cssOnly:!0},p={backstoreOnly:!0},_=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=f.default.componentNames.MAIN,e.canvas=null,e.canvasImage=null,e.cssMaxWidth=h,e.cssMaxHeight=d,e.imageName="",e}return a(t,e),s(t,[{key:"toDataURL",value:function(e){return this.canvas&&this.canvas.toDataURL(e)}},{key:"setCanvasImage",value:function(e,t){t&&tui.util.stamp(t),this.imageName=e,this.canvasImage=t}},{key:"setCssMaxDimension",value:function(e){this.cssMaxWidth=e.width||this.cssMaxWidth,this.cssMaxHeight=e.height||this.cssMaxHeight}},{key:"setCanvasElement",value:function(e){var t=void 0,n=void 0;t=e.jquery?e[0]:e.nodeType?e:document.querySelector(e),"CANVAS"!==t.nodeName.toUpperCase()&&(n=document.createElement("canvas"),t.appendChild(n)),this.canvas=new fabric.Canvas(n,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1})}},{key:"adjustCanvasDimension",value:function(){var e=this.canvasImage.scale(1),t=e.getBoundingRect(),n=t.width,i=t.height,r=this._calcMaxDimension(n,i);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":r.width+"px","max-height":r.height+"px"}),this.setCanvasBackstoreDimension({width:n,height:i}),this.canvas.centerObject(e)}},{key:"_calcMaxDimension",value:function(e,t){var n=this.cssMaxWidth/e,i=this.cssMaxHeight/t,r=Math.min(e,this.cssMaxWidth),o=Math.min(t,this.cssMaxHeight);return n<1&&n<i?(r=e*n,o=t*n):i<1&&i<n&&(r=e*i,o=t*i),{width:Math.floor(r),height:Math.floor(o)}}},{key:"setCanvasCssDimension",value:function(e){this.canvas.setDimensions(e,v)}},{key:"setCanvasBackstoreDimension",value:function(e){this.canvas.setDimensions(e,p)}},{key:"setImageProperties",value:function(e,t){var n=this.canvasImage;n&&(n.set(e).setCoords(),t&&this.canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this.canvas.getElement()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}}]),t}(c.default);e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(5),c=i(u),l=n(2),f=i(l),h=n(1),d=i(h),v=d.default.componentNames,p=d.default.rejectMessages,_=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=v.ROTATION,n}return a(t,e),s(t,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(e){var t=this.getCurrentAngle()%360;if(e%=360,e===t)return c.default.reject(p.rotation);var n=this.getCanvasImage(),i=n.getCenterPoint();n.setAngle(e).setCoords(),this.adjustCanvasDimension();var r=n.getCenterPoint();return this._rotateForEachObject(i,r,e-t),c.default.resolve(e)}},{key:"_rotateForEachObject",value:function(e,t,n){var i=this.getCanvas(),r={x:e.x-t.x,y:e.y-t.y};i.forEachObject(function(t){var i=t.getCenterPoint(),o=fabric.util.degreesToRadians(n),a=fabric.util.rotatePoint(i,e,o);t.set({left:a.x-r.x,top:a.y-r.y,angle:(t.angle+n)%360}),t.setCoords()}),i.renderAll()}},{key:"rotate",value:function(e){var t=this.getCurrentAngle();return this.setAngle(t+e)}}]),t}(f.default);e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h=n(51),d=i(h),v=tui.util,p=v.extend,_=v.bind,g=v.inArray,y=f.default.keyCodes,m="rect",b={
strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0,lockSkewingX:!0,lockSkewingY:!0,lockUniScaling:!1,bringForward:!0,isRegular:!1},k=["rect","circle","triangle"],C=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=f.default.componentNames.SHAPE,n._shapeObj=null,n._type=m,n._options=b,n._isSelected=!1,n._startPoint={},n._withShiftKey=!1,n._handlers={mousedown:_(n._onFabricMouseDown,n),mousemove:_(n._onFabricMouseMove,n),mouseup:_(n._onFabricMouseUp,n),keydown:_(n._onKeyDown,n),keyup:_(n._onKeyUp,n)},n}return a(t,e),s(t,[{key:"startDrawingMode",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="crosshair",e.selection=!1,e.uniScaleTransform=!0,e.on({"mouse:down":this._handlers.mousedown}),fabric.util.addListener(document,"keydown",this._handlers.keydown),fabric.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"endDrawingMode",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="default",e.selection=!0,e.uniScaleTransform=!1,e.off({"mouse:down":this._handlers.mousedown}),fabric.util.removeListener(document,"keydown",this._handlers.keydown),fabric.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(e,t){this._type=e,t&&(this._options=p(this._options,t))}},{key:"add",value:function(e,t){var n=this.getCanvas();t=this._createOptions(t);var i=this._createInstance(e,t);this._bindEventOnShape(i),n.add(i)}},{key:"change",value:function(e,t){g(e.get("type"),k)<0||(e.set(t),this.getCanvas().renderAll())}},{key:"_createInstance",value:function(e,t){var n=void 0;switch(e){case"rect":n=new fabric.Rect(t);break;case"circle":n=new fabric.Ellipse(p({type:"circle"},t));break;case"triangle":n=new fabric.Triangle(t);break;default:n={}}return n}},{key:"_createOptions",value:function(e){var t=f.default.fObjectOptions.SELECTION_STYLE;return e=p({},b,t,e),e.isRegular&&(e.lockUniScaling=!0),e}},{key:"_bindEventOnShape",value:function(e){var t=this,n=this.getCanvas();e.on({added:function(){t._shapeObj=this,d.default.setOrigins(t._shapeObj)},selected:function(){t._isSelected=!0,t._shapeObj=this,n.uniScaleTransform=!0,n.defaultCursor="default",d.default.setOrigins(t._shapeObj)},deselected:function(){t._isSelected=!1,t._shapeObj=null,n.defaultCursor="crosshair",n.uniScaleTransform=!1},modified:function(){var e=t._shapeObj;d.default.adjustOriginToCenter(e),d.default.setOrigins(e)},scaling:function(e){var i=n.getPointer(e.e),r=t._shapeObj;n.setCursor("crosshair"),d.default.resize(r,i,!0)}})}},{key:"_onFabricMouseDown",value:function(e){if(!this._isSelected&&!this._shapeObj){var t=this.getCanvas();this._startPoint=t.getPointer(e.e),t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),i=this._startPoint.x,r=this._startPoint.y,o=i-n.x,a=r-n.y,s=this._shapeObj;s?(this._shapeObj.set({isRegular:this._withShiftKey}),d.default.resize(s,n),t.renderAll()):this.add(this._type,{left:i,top:r,width:o,height:a})}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas(),t=this._shapeObj;t&&d.default.adjustOriginToCenter(t),this._shapeObj=null,e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(e){e.keyCode===y.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(e){e.keyCode===y.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}}]),t}(c.default);e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(2),c=i(u),l=n(1),f=i(l),h=n(8),d=i(h),v={fill:"#000000",left:0,top:0},p={fill:"#000000",fontStyle:"normal",fontWeight:"normal",textAlign:"left",textDecoraiton:""},_=tui.util.browser,g="tui-image-eidtor-textarea",y=d.default.makeStyleText({position:"absolute",padding:0,display:"none",border:"1px dotted red",overflow:"hidden",resize:"none",outline:"none","border-radius":0,"background-color":"transparent","-webkit-appearance":"none","z-index":9999,"white-space":"pre"}),m=.1,b=500,k=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setParent(e),n.name=f.default.componentNames.TEXT,n._defaultStyles=v,n._isSelected=!1,n._selectedObj={},n._editingObj={},n._listeners={},n._textarea=null,n._ratio=1,n._lastClickTime=(new Date).getTime(),n._editingObjInfos={},n.isPrevEditing=!1,n}return a(t,e),s(t,[{key:"start",value:function(e){var t=this.getCanvas();this._listeners=e,t.selection=!1,t.defaultCursor="text",t.on({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._onFabricScaling}),this._createTextarea(),this.setCanvasRatio()}},{key:"end",value:function(){var e=this.getCanvas();e.selection=!0,e.defaultCursor="default",e.deactivateAllWithDispatch(),e.off({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._onFabricScaling}),this._removeTextarea(),this._listeners={}}},{key:"add",value:function(e,t){var n=this.getCanvas(),i=this._defaultStyles;this._setInitPos(t.position),t.styles&&(i=tui.util.extend(t.styles,i));var r=new fabric.Text(e,i);r.set(f.default.fObjectOptions.SELECTION_STYLE),r.on({mouseup:tui.util.bind(this._onFabricMouseUp,this)}),n.add(r),n.getActiveObject()||n.setActiveObject(r),this.isPrevEditing=!0}},{key:"change",value:function(e,t){e.set("text",t),this.getCanvas().renderAll()}},{key:"setStyle",value:function(e,t){tui.util.forEach(t,function(n,i){e[i]===n&&(t[i]=p[i]||"")},this),e.set(t),this.getCanvas().renderAll()}},{key:"setSelectedInfo",value:function(e,t){this._selectedObj=e,this._isSelected=t}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var e=this.getCanvasElement(),t=parseInt(e.style.maxWidth,10),n=e.width,i=n/t;this._ratio=i}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_setInitPos",value:function(e){e=e||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=e.x,this._defaultStyles.top=e.y}},{key:"_createTextarea",value:function(){var e=this.getCanvasElement().parentNode,t=document.createElement("textarea");t.className=g,t.setAttribute("style",y),t.setAttribute("wrap","off"),e.appendChild(t),this._textarea=t,this._listeners=tui.util.extend(this._listeners,{input:tui.util.bind(this._onInput,this),keydown:tui.util.bind(this._onKeyDown,this),blur:tui.util.bind(this._onBlur,this),scroll:tui.util.bind(this._onScroll,this)}),_.msie&&9===_.version?fabric.util.addListener(t,"keydown",this._listeners.keydown):fabric.util.addListener(t,"input",this._listeners.input),fabric.util.addListener(t,"blur",this._listeners.blur),fabric.util.addListener(t,"scroll",this._listeners.scroll)}},{key:"_removeTextarea",value:function(){var e=this.getCanvasElement().parentNode,t=e.querySelector("textarea");e.removeChild(t),this._textarea=null,_.msie&&_.version<10?fabric.util.removeListener(t,"keydown",this._listeners.keydown):fabric.util.removeListener(t,"input",this._listeners.input),fabric.util.removeListener(t,"blur",this._listeners.blur),fabric.util.removeListener(t,"scroll",this._listeners.scroll)}},{key:"_onInput",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._textarea.style;t.setText(this._textarea.value),n.width=Math.ceil(t.getWidth()/e)+"px",n.height=Math.ceil(t.getHeight()/e)+"px"}},{key:"_onKeyDown",value:function(){var e=this,t=this.getCanvasRatio(),n=this._editingObj,i=this._textarea.style;setTimeout(function(){n.setText(e._textarea.value),i.width=Math.ceil(n.getWidth()/t)+"px",i.height=Math.ceil(n.getHeight()/t)+"px"},0)}},{key:"_onBlur",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._editingObjInfos,i=t.getWidth()/e-n.width/e,r=t.getHeight()/e-n.height/e;1===e&&(i/=2,r/=2),this._textarea.style.display="none",this._editingObj.set({left:n.left+i,top:n.top+r}),this.getCanvas().add(this._editingObj),this.getCanvas().on("object:removed",this._listeners.remove)}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(e){var t=e.target,n=t.getFontSize()*t.getScaleY();t.setFontSize(n),t.setScaleX(1),t.setScaleY(1)}},{key:"_onFabricMouseUp",value:function(e){var t=(new Date).getTime();this._isDoubleClick(t)&&(this._changeToEditingMode(e.target),this._listeners.dbclick()),this._lastClickTime=t}},{key:"_isDoubleClick",value:function(e){return e-this._lastClickTime<b}},{key:"_changeToEditingMode",value:function(e){var t=this.getCanvasRatio(),n=this._textarea.style;this.isPrevEditing=!0,this.getCanvas().off("object:removed",this._listeners.remove),e.remove(),this._editingObj=e,this._textarea.value=e.getText(),this._editingObjInfos={left:this._editingObj.getLeft(),top:this._editingObj.getTop(),width:this._editingObj.getWidth(),height:this._editingObj.getHeight()},n.display="block",n.left=e.oCoords.tl.x/t+"px",n.top=e.oCoords.tl.y/t+"px",n.width=Math.ceil(e.getWidth()/t)+"px",n.height=Math.ceil(e.getHeight()/t)+"px",n.transform="rotate("+e.getAngle()+"deg)",n.color=e.getFill(),n["font-size"]=e.getFontSize()/t+"px",n["font-family"]=e.getFontFamily(),n["font-style"]=e.getFontStyle(),n["font-weight"]=e.getFontWeight(),n["text-align"]=e.getTextAlign(),n["line-height"]=e.getLineHeight()+m,n["transform-origin"]="left top",this._textarea.focus()}}]),t}(c.default);e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(8),o=i(r),a=o.default.clamp,s="tl",u="tr",c="mt",l="ml",f="mr",h="mb",d="bl",v="br",p=fabric.util.createClass(fabric.Rect,{initialize:function(e){e.type="cropzone",this.callSuper("initialize",e),this.on({moving:this._onMoving,scaling:this._onScaling})},_render:function(e){var t=7,n=7;this.callSuper("_render",e);var i=this.flipX?-1:1,r=this.flipY?-1:1,o=i/this.scaleX,a=r/this.scaleY;e.scale(o,a),this._fillOuterRect(e,"rgba(0, 0, 0, 0.55)"),this._strokeBorder(e,"rgb(0, 0, 0)",t),this._strokeBorder(e,"rgb(255, 255, 255)",t,n),e.scale(1/o,1/a)},_fillOuterRect:function(e,t){var n=this._getCoordinates(e),i=n.x,r=n.y;e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(i[0]-1,r[0]-1),e.lineTo(i[3]+1,r[0]-1),e.lineTo(i[3]+1,r[3]+1),e.lineTo(i[0]-1,r[3]-1),e.lineTo(i[0]-1,r[0]-1),e.closePath(),e.moveTo(i[1],r[1]),e.lineTo(i[1],r[2]),e.lineTo(i[2],r[2]),e.lineTo(i[2],r[1]),e.lineTo(i[1],r[1]),e.closePath(),e.fill(),e.restore()},_getCoordinates:function(e){var t=Math.ceil,n=this.getWidth(),i=this.getHeight(),r=n/2,o=i/2,a=this.getLeft(),s=this.getTop(),u=e.canvas;return{x:tui.util.map([-(r+a),-r,r,r+(u.width-a-n)],t),y:tui.util.map([-(o+s),-o,o,o+(u.height-s-i)],t)}},_strokeBorder:function(e,t,n,i){var r=this.getWidth()/2,o=this.getHeight()/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([n,n]),i&&(e.lineDashOffset=i),e.beginPath(),e.moveTo(-r,-o),e.lineTo(r,-o),e.lineTo(r,o),e.lineTo(-r,o),e.lineTo(-r,-o),e.stroke(),e.restore()},_onMoving:function(){var e=this.canvas,t=this.getLeft(),n=this.getTop(),i=this.getWidth(),r=this.getHeight(),o=e.getWidth()-i,s=e.getHeight()-r;this.setLeft(a(t,0,o)),this.setTop(a(n,0,s))},_onScaling:function(e){var t=this.canvas.getPointer(e.e),n=this._calcScalingSizeFromPointer(t);this.scale(1).set(n)},_calcScalingSizeFromPointer:function(e){var t=e.x,n=e.y,i=this._calcTopLeftScalingSizeFromPointer(t,n),r=this._calcBottomRightScalingSizeFromPointer(t,n);return this._makeScalingSettings(i,r)},_calcTopLeftScalingSizeFromPointer:function(e,t){var n=this.getHeight()+this.top,i=this.getWidth()+this.left,r=a(t,0,n-1),o=a(e,0,i-1);return{top:r,left:o,width:i-o,height:n-r}},_calcBottomRightScalingSizeFromPointer:function(e,t){var n=this.canvas,i=n.width,r=n.height,o=this.left,s=this.top;return{width:a(e,o+1,i)-o,height:a(t,s+1,r)-s}},_makeScalingSettings:function(e,t){var n=e.width,i=e.height,r=t.height,o=t.width,a=e.left,p=e.top,_=void 0;switch(this.__corner){case s:_=e;break;case u:_={width:o,height:i,top:p};break;case d:_={width:n,height:r,left:a};break;case v:_=t;break;case l:_={width:n,left:a};break;case c:_={height:i,top:p};break;case f:_={width:o};break;case h:_={height:r}}return _},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0}});e.exports=p},function(e,t){"use strict";var n=fabric.util.createClass(fabric.Image.filters.Mask,{applyTo:function(e){if(this.mask){var t=e.width,n=e.height,i=this._createCanvasOfMask(t,n),r=e.getContext("2d"),o=i.getContext("2d"),a=r.getImageData(0,0,t,n);this._drawMask(o,e,r),this._mapData(o,a,t,n),r.putImageData(a,0,0)}},_createCanvasOfMask:function(e,t){var n=fabric.util.createCanvasElement();return n.width=e,n.height=t,n},_drawMask:function(e){var t=this.mask,n=t.getElement(),i=t.getLeft(),r=t.getTop(),o=t.getAngle();e.save(),e.translate(i,r),e.rotate(o*Math.PI/180),e.scale(t.scaleX,t.scaleY),e.drawImage(n,-n.width/2,-n.height/2),e.restore()},_mapData:function(e,t,n,i){for(var r=t.data,o=e.getImageData(0,0,n,i).data,a=this.channel,s=t.width*t.height*4,u=0;u<s;u+=4)r[u+3]=o[u+a]}});e.exports=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return tui.util.stamp(e),new p.default({execute:function(t){return new d.default(function(n,i){var r=t[b].getCanvas();r.contains(e)?i():(r.add(e),n(e))})},undo:function(t){return new d.default(function(n,i){var r=t[b].getCanvas();r.contains(e)?(r.remove(e),n(e)):i()})}})}function o(e,t){return new p.default({execute:function(n){var i=n[k],r=i.getCanvas();return this.store={prevName:i.getImageName(),prevImage:i.getCanvasImage(),objects:r.getObjects().slice()},r.clear(),i.load(e,t)},undo:function(e){var t=e[k],n=t.getCanvas(),i=this.store,r=n;return n.clear(),n.add.apply(r,i.objects),t.load(i.prevName,i.prevImage)}})}function a(e){return new p.default({execute:function(t){var n=t[C];return this.store=n.getCurrentSetting(),n[e]()},undo:function(e){var t=e[C];return t.set(this.store)}})}function s(e,t){return new p.default({execute:function(n){var i=n[O];return this.store=i.getCurrentAngle(),i[e](t)},undo:function(e){var t=e[O];return t.setAngle(this.store)}})}function u(){return new p.default({execute:function(e){var t=this;return new d.default(function(n,i){var r=e[b].getCanvas(),o=r.getObjects();t.store=o.slice(),t.store.length?(tui.util.forEach(o.slice(),function(e){e.remove()}),n()):i()})},undo:function(e){var t=e[b].getCanvas(),n=t;return t.add.apply(n,this.store),d.default.resolve()}})}function c(e){return new p.default({execute:function(t){var n=this;return new d.default(function(i,r){var o=t[b].getCanvas(),a=e&&e.isType("group")&&!e.isEmpty();a?(o.discardActiveGroup(),n.store=e.getObjects(),e.forEachObject(function(e){e.remove()}),i()):o.contains(e)?(n.store=[e],e.remove(),i()):r()})},undo:function(e){var t=e[b].getCanvas(),n=t;return t.add.apply(n,this.store),d.default.resolve()}})}function l(e,t){return new p.default({execute:function(n){var i=n[E];return"mask"===e&&(this.store=t.mask,t.mask.remove()),i.add(e,t)},undo:function(t){var n=t[E];return"mask"===e&&n.getCanvas().add(this.store),n.remove(e)}})}function f(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return w[e].apply(null,n)}var h=n(5),d=i(h),v=n(53),p=i(v),_=n(1),g=i(_),y=g.default.componentNames,m=g.default.commandNames,b=y.MAIN,k=y.IMAGE_LOADER,C=y.FLIP,O=y.ROTATION,E=y.FILTER,w={};w[m.LOAD_IMAGE]=o,w[m.FLIP_IMAGE]=a,w[m.ROTATE_IMAGE]=s,w[m.CLEAR_OBJECTS]=u,w[m.ADD_OBJECT]=r,w[m.REMOVE_OBJECT]=c,w[m.APPLY_FILTER]=l,e.exports={create:f}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=n(8),o=i(r),a=o.default.keyMirror,s=a("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),u={UN_IMPLEMENTATION:"Should implement a method: ",NO_COMPONENT_NAME:"Should set a component name"},c={UN_IMPLEMENTATION:function(e){return u.UN_IMPLEMENTATION+e},NO_COMPONENT_NAME:function(){return u.NO_COMPONENT_NAME}};e.exports={types:tui.util.extend({},s),create:function(e){e=e.toLowerCase();for(var t=c[e],n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return t.apply(void 0,i)}}},function(e,t){"use strict";function n(e){var t=e.getOriginX(),n=e.getOriginY(),i=t.substring(0,1)+n.substring(0,1);e.startPoint=e.origins[i]}function i(e,t,n){var i=e.x,r=e.y,o=t.x,a=t.y,s=n*Math.PI/180,u=(o-i)*Math.cos(s)-(a-r)*Math.sin(s)+i,c=(o-i)*Math.sin(s)+(a-r)*Math.cos(s)+r;return{originX:i>u?"right":"left",originY:r>c?"bottom":"top"}}function r(e){return"center"===e.getOriginX()&&"center"===e.getOriginY()}function o(e,t){var n=t.getPointByOrigin("center","center"),r=-t.getAngle(),o=i(n,e,r),a=o.originX,s=o.originY,u=t.getPointByOrigin(a,s),c=t.getLeft()-(n.x-u.x),l=t.getTop()-(n.x-u.y);t.set({originX:a,originY:s,left:c,top:l}),t.setCoords()}function a(e,t){var n=t.startPoint,r=-t.getAngle(),o=i(n,e,r),a=o.originX,s=o.originY;t.setPositionByOrigin(n,a,s)}function s(e){var t=e.type,n=l[t],i=e.scaleX,r=e.scaleY,o=e[n.w]*i,a=e[n.h]*r;if(e.isRegular){var s=Math.max(i,r);o=e[n.w]*s,a=e[n.h]*s}var u={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};u[n.w]=o,u[n.h]=a,e.set(u)}function u(e,t){var n=t.startPoint,i=t.type,r=c[i],o=l[i],a=t.strokeWidth,s=!("triangle"!==t.type),u={},f=Math.abs(n.x-e.x)/r,h=Math.abs(n.y-e.y)/r;f>a&&(f-=a/r),h>a&&(h-=a/r),t.isRegular&&(f=h=Math.max(f,h),s&&(h=Math.sqrt(3)/2*f)),u[o.w]=f,u[o.h]=h,t.set(u)}var c={rect:1,circle:2,triangle:1},l={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};e.exports={setOrigins:function(e){var t=e.getPointByOrigin("left","top"),n=e.getPointByOrigin("right","top"),i=e.getPointByOrigin("right","bottom"),r=e.getPointByOrigin("left","bottom");e.origins={lt:t,rt:n,rb:i,lb:r}},resize:function(e,t,i){r(e)&&(o(t,e),n(e)),i?s(e,t):u(t,e),a(t,e)},adjustOriginToCenter:function(e){var t=e.getPointByOrigin("center","center"),n=e.getOriginX(),i=e.getOriginY(),r=e.getPointByOrigin(n,i),o=e.getLeft()+(t.x-r.x),a=e.getTop()+(t.y-r.y);e.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:o,top:a}),e.setCoords()}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(54),s=i(a),u=n(49),c=i(u),l=n(1),f=i(l),h=f.default.eventNames,d=f.default.componentNames,v=f.default.commandNames,p=f.default.states,_=f.default.keyCodes,g=f.default.fObjectOptions,y=tui.util,m=y.isUndefined,b=y.bind,k=y.forEach,C=y.extend,O=y.hasStamp,E=function(){function e(t,n){r(this,e),n=n||{},this._invoker=new s.default,this._canvas=null,this._state=p.NORMAL,this._handlers={keydown:b(this._onKeyDown,this),mousedown:b(this._onMouseDown,this),addedObject:b(this._onAddedObject,this),removedObject:b(this._onRemovedObject,this),selectedObject:b(this._onSelectedObject,this),movingObject:b(this._onMovingObject,this),scalingObject:b(this._onScalingObject,this),createdPath:this._onCreatedPath},this._setCanvas(t,n.cssMaxWidth,n.cssMaxHeight),this._attachInvokerEvents(),this._attachCanvasEvents(),this._attachDomEvents(),n.selectionStyle&&this._setSelectionStyle(n.selectionStyle)}return o(e,[{key:"_setSelectionStyle",value:function(e){C(g.SELECTION_STYLE,e)}},{key:"_attachInvokerEvents",value:function(){var e=h.PUSH_UNDO_STACK,t=h.PUSH_REDO_STACK,n=h.EMPTY_UNDO_STACK,i=h.EMPTY_REDO_STACK;this._invoker.on(e,this.fire.bind(this,e)),this._invoker.on(t,this.fire.bind(this,t)),this._invoker.on(n,this.fire.bind(this,n)),this._invoker.on(i,this.fire.bind(this,i))}},{key:"_attachCanvasEvents",value:function(){this._canvas.on({"mouse:down":this._handlers.mousedown,"object:added":this._handlers.addedObject,"object:removed":this._handlers.removedObject,"object:moving":this._handlers.movingObject,"object:scaling":this._handlers.scalingObject,"object:selected":this._handlers.selectedObject,"path:created":this._handlers.createdPath})}},{key:"_attachDomEvents",value:function(){fabric.util.addListener(document,"keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){fabric.util.removeListener(document,"keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(e){(e.ctrlKey||e.metaKey)&&e.keyCode===_.Z&&this.undo(),(e.ctrlKey||e.metaKey)&&e.keyCode===_.Y&&this.redo(),e.keyCode!==_.BACKSPACE&&e.keyCode!==_.DEL||!this._canvas.getActiveObject()||(e.preventDefault(),this.removeActiveObject())}},{key:"_onMouseDown",value:function(e){var t=this._canvas.getPointer(e.e);this.fire(h.MOUSE_DOWN,{e:e.e,originPointer:t})}},{key:"_onAddedObject",value:function(e){var t=e.target;if(!t.isType("cropzone")&&!t.isType("text")){if(!O(t)){var n=c.default.create(v.ADD_OBJECT,t);this._invoker.pushUndoStack(n),this._invoker.clearRedoStack()}this.fire(h.ADD_OBJECT,t)}}},{key:"_onRemovedObject",value:function(e){this.fire(h.REMOVE_OBJECT,e.target)}},{key:"_onSelectedObject",value:function(e){this.fire(h.SELECT_OBJECT,e.target)}},{key:"_onMovingObject",value:function(e){this.fire(h.ADJUST_OBJECT,e.target,"move")}},{key:"_onScalingObject",value:function(e){this.fire(h.ADJUST_OBJECT,e.target,"move")}},{key:"_onCreatedPath",value:function(e){e.path.set(f.default.fObjectOptions.SELECTION_STYLE)}},{key:"_onFabricSelectClear",value:function(e){var t=this._getComponent(d.TEXT),n=t.getSelectedObj();if(t.isPrevEditing=!0,t.setSelectedInfo(e.target,!1),""===n.text)n.remove();else if(!O(n)){var i=c.default.create(v.ADD_OBJECT,n);this._invoker.pushUndoStack(i),this._invoker.clearRedoStack()}}},{key:"_onFabricSelect",value:function(e){var t=this._getComponent(d.TEXT),n=t.getSelectedObj();if(t.isPrevEditing=!0,""===n.text)n.remove();else if(!O(n)&&t.isSelected()){var i=c.default.create(v.ADD_OBJECT,n);this._invoker.pushUndoStack(i),this._invoker.clearRedoStack()}t.setSelectedInfo(e.target,!0)}},{key:"_setCanvas",value:function(e,t,n){var i=this._getMainComponent();i.setCanvasElement(e),i.setCssMaxDimension({width:t,height:n}),this._canvas=i.getCanvas()}},{key:"_getMainComponent",value:function(){return this._getComponent(d.MAIN)}},{key:"_getComponent",value:function(e){return this._invoker.getComponent(e)}},{key:"getCurrentState",value:function(){return this._state}},{key:"clearObjects",value:function(){var e=c.default.create(v.CLEAR_OBJECTS),t=this.fire.bind(this,h.CLEAR_OBJECTS);e.setExecuteCallback(t),this.execute(e)}},{key:"endAll",value:function(){this.endTextMode(),this.endFreeDrawing(),this.endLineDrawing(),this.endCropping(),this.endDrawingShapeMode(),this.deactivateAll(),this._state=p.NORMAL}},{key:"deactivateAll",value:function(){this._canvas.deactivateAll(),this._canvas.renderAll()}},{key:"execute",value:function(e){this.endAll(),this._invoker.invoke(e)}},{key:"undo",value:function(){this.endAll(),this._invoker.undo()}},{key:"redo",value:function(){this.endAll(),this._invoker.redo()}},{key:"loadImageFromFile",value:function(e,t){e&&this.loadImageFromURL(URL.createObjectURL(e),t||e.name)}},{key:"loadImageFromURL",value:function(e,t){var n=this;if(t&&e){var i=b(this._callbackAfterImageLoading,this),r=c.default.create(v.LOAD_IMAGE,t,e);r.setExecuteCallback(i).setUndoCallback(function(e){e?i(e):n.fire(h.CLEAR_IMAGE)}),this.execute(r)}}},{key:"_callbackAfterImageLoading",value:function(e){var t=this._getMainComponent(),n=t.getCanvasElement(),i=n.getBoundingClientRect(),r=i.width,o=i.height;this.fire(h.LOAD_IMAGE,{originalWidth:e.width,originalHeight:e.height,currentWidth:r,currentHeight:o})}},{key:"addImageObject",value:function(e){e&&fabric.Image.fromURL(e,b(this._callbackAfterLoadingImageObject,this),{crossOrigin:"Anonymous"})}},{key:"_callbackAfterLoadingImageObject",value:function(e){var t=this._getMainComponent(),n=t.getCanvasImage().getCenterPoint();e.set(f.default.fObjectOptions.SELECTION_STYLE),e.set({left:n.x,top:n.y,crossOrigin:"anonymous"}),this._canvas.add(e).setActiveObject(e)}},{key:"startCropping",value:function(){if(this.getCurrentState()!==p.CROP){this.endAll(),this._state=p.CROP;var e=this._getComponent(d.CROPPER);e.start(),this.fire(h.START_CROPPING)}}},{key:"endCropping",value:function(e){var t=this;if(this.getCurrentState()===p.CROP){var n=this._getComponent(d.CROPPER);this._state=p.NORMAL;var i=n.end(e);this.once("loadImage",function(){t.fire(h.END_CROPPING)}),i&&this.loadImageFromURL(i.url,i.imageName)}}},{key:"_flip",value:function(e){var t=this,n=c.default.create(v.FLIP_IMAGE,e),i=function(e){var n=e.setting,i=e.angle;t.fire(h.FLIP_IMAGE,n,i)};n.setExecuteCallback(i).setUndoCallback(i),this.execute(n)}},{key:"flipX",value:function(){this._flip("flipX")}},{key:"flipY",value:function(){this._flip("flipY")}},{key:"resetFlip",value:function(){this._flip("reset")}},{key:"_rotate",value:function(e,t){var n=this.fire.bind(this,h.ROTATE_IMAGE),i=c.default.create(v.ROTATE_IMAGE,e,t);i.setExecuteCallback(n).setUndoCallback(n),this.execute(i)}},{key:"rotate",value:function(e){this._rotate("rotate",e)}},{key:"setAngle",value:function(e){this._rotate("setAngle",e)}},{key:"startFreeDrawing",value:function(e){this.getCurrentState()!==p.FREE_DRAWING&&(this.endAll(),this._getComponent(d.FREE_DRAWING).start(e),this._state=p.FREE_DRAWING,this.fire(h.START_FREE_DRAWING))}},{key:"setBrush",value:function(e){var t=this._state,n=void 0;switch(t){case p.LINE:n=d.LINE;break;default:n=d.FREE_DRAWING}this._getComponent(n).setBrush(e)}},{key:"endFreeDrawing",value:function(){this.getCurrentState()===p.FREE_DRAWING&&(this._getComponent(d.FREE_DRAWING).end(),this._state=p.NORMAL,this.fire(h.END_FREE_DRAWING))}},{key:"startLineDrawing",value:function(e){this.getCurrentState()!==p.LINE&&(this.endAll(),this._getComponent(d.LINE).start(e),this._state=p.LINE,this.fire(h.START_LINE_DRAWING))}},{key:"endLineDrawing",value:function(){this.getCurrentState()===p.LINE&&(this._getComponent(d.LINE).end(),this._state=p.NORMAL,this.fire(h.END_LINE_DRAWING))}},{key:"startDrawingShapeMode",value:function(){this.getCurrentState()!==p.SHAPE&&(this._state=p.SHAPE,this._getComponent(d.SHAPE).startDrawingMode())}},{key:"setDrawingShape",value:function(e,t){this._getComponent(d.SHAPE).setStates(e,t)}},{key:"addShape",value:function(e,t){t=t||{},this._setPositions(t),this._getComponent(d.SHAPE).add(e,t)}},{key:"changeShape",value:function(e){var t=this._canvas.getActiveObject(),n=this._getComponent(d.SHAPE);t&&n.change(t,e)}},{key:"endDrawingShapeMode",value:function(){this.getCurrentState()===p.SHAPE&&(this._getComponent(d.SHAPE).endDrawingMode(),this._state=p.NORMAL)}},{key:"startTextMode",value:function(){this.getCurrentState()!==p.TEXT&&(this._state=p.TEXT,this._getComponent(d.TEXT).start({mousedown:b(this._onFabricMouseDown,this),select:b(this._onFabricSelect,this),selectClear:b(this._onFabricSelectClear,this),dbclick:b(this._onDBClick,this),remove:this._handlers.removedObject}))}},{key:"addText",value:function(e,t){this.getCurrentState()!==p.TEXT&&(this._state=p.TEXT),this._getComponent(d.TEXT).add(e||"",t||{})}},{key:"changeText",value:function(e){var t=this._canvas.getActiveObject();this.getCurrentState()===p.TEXT&&t&&this._getComponent(d.TEXT).change(t,e)}},{key:"changeTextStyle",value:function(e){var t=this._canvas.getActiveObject();this.getCurrentState()===p.TEXT&&t&&this._getComponent(d.TEXT).setStyle(t,e)}},{key:"endTextMode",value:function(){this.getCurrentState()===p.TEXT&&(this._state=p.NORMAL,this._getComponent(d.TEXT).end())}},{key:"_onDBClick",value:function(){this.fire(h.EDIT_TEXT)}},{key:"_onFabricMouseDown",value:function(e){var t=e.target,n=e.e||{},i=this._canvas.getPointer(n),r=this._getComponent(d.TEXT);if(!t||t.isType("text"))return r.isPrevEditing?void(r.isPrevEditing=!1):void this.fire(h.ACTIVATE_TEXT,{type:t?"select":"new",text:t?t.text:"",styles:t?{fill:t.fill,fontFamily:t.fontFamily,fontSize:t.fontSize,fontStyle:t.fontStyle,textAlign:t.textAlign,textDecoration:t.textDecoration}:{},originPosition:{x:i.x,y:i.y},clientPosition:{x:n.clientX||0,y:n.clientY||0}})}},{key:"registerIcons",value:function(e){this._getComponent(d.ICON).registerPaths(e)}},{key:"addIcon",value:function(e,t){t=t||{},this._setPositions(t),this._getComponent(d.ICON).add(e,t)}},{key:"changeIconColor",value:function(e){var t=this._canvas.getActiveObject();this._getComponent(d.ICON).setColor(e,t)}},{key:"removeActiveObject",value:function(){var e=this._canvas,t=e.getActiveObject()||e.getActiveGroup(),n=c.default.create(v.REMOVE_OBJECT,t);this.execute(n)}},{key:"applyFilter",value:function(e,t){var n=this;if("mask"===e&&!t){var i=this._canvas.getActiveObject();if(!i||!i.isType("image"))return;t={mask:i}}var r=c.default.create(v.APPLY_FILTER,e,t),o=function(e){n.fire(h.APPLY_FILTER,e.type,e.action)};r.setExecuteCallback(o).setUndoCallback(o),this.execute(r)}},{key:"toDataURL",value:function(e){return this._getMainComponent().toDataURL(e)}},{key:"getImageName",value:function(){return this._getMainComponent().getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(e){var t=this._getMainComponent();e&&(t.setCssMaxDimension(e),t.adjustCanvasDimension())}},{key:"destroy",value:function(){var e=this,t=this._canvas.wrapperEl;this.endAll(),this._detachDomEvents(),this._canvas.clear(),t.parentNode.removeChild(t),k(this,function(t,n){e[n]=null},this)}},{key:"_setPositions",value:function(e){var t=this._canvas.getCenter();m(e.left)&&(e.left=t.left),m(e.top)&&(e.top=t.top)}}]),e}();tui.util.CustomEvents.mixin(E),e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(50),s=i(a),u=s.default.create,c=s.default.types,l=function(){function e(t){r(this,e),this.execute=t.execute,this.undo=t.undo,this.executeCallback=null,this.undoCallback=null}return o(e,[{key:"execute",value:function(){throw new Error(u(c.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(u(c.UN_IMPLEMENTATION,"undo"))}},{key:"setExecuteCallback",value:function(e){return this.executeCallback=e,this}},{key:"setUndoCallback",value:function(e){return this.undoCallback=e,this}}]),e}();e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{
default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(5),s=i(a),u=n(41),c=i(u),l=n(36),f=i(l),h=n(43),d=i(h),v=n(38),p=i(v),_=n(44),g=i(_),y=n(39),m=i(y),b=n(42),k=i(b),C=n(46),O=i(C),E=n(40),w=i(E),T=n(37),S=i(T),x=n(45),j=i(x),P=n(1),A=i(P),M=A.default.eventNames,I=A.default.rejectMessages,R=function(){function e(){r(this,e),this._customEvents=new tui.util.CustomEvents,this._undoStack=[],this._redoStack=[],this._componentMap={},this._isLocked=!1,this._createComponents()}return o(e,[{key:"_createComponents",value:function(){var e=new d.default;this._register(e),this._register(new c.default(e)),this._register(new f.default(e)),this._register(new p.default(e)),this._register(new g.default(e)),this._register(new m.default(e)),this._register(new k.default(e)),this._register(new O.default(e)),this._register(new w.default(e)),this._register(new S.default(e)),this._register(new j.default(e))}},{key:"_register",value:function(e){this._componentMap[e.getName()]=e}},{key:"_invokeExecution",value:function(e){var t=this;return this.lock(),e.execute(this._componentMap).then(function(n){return t.pushUndoStack(e),tui.util.isFunction(e.executeCallback)&&e.executeCallback(n),n}).catch(function(){}).then(function(e){return t.unlock(),e})}},{key:"_invokeUndo",value:function(e){var t=this;return this.lock(),e.undo(this._componentMap).then(function(n){return t.pushRedoStack(e),tui.util.isFunction(e.undoCallback)&&e.undoCallback(n),n}).catch(function(){}).then(function(e){return t.unlock(),e})}},{key:"_fire",value:function(){for(var e=this._customEvents,t=e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];e.fire.apply(t,i)}},{key:"on",value:function(){for(var e=this._customEvents,t=e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];e.on.apply(t,i)}},{key:"getComponent",value:function(e){return this._componentMap[e]}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"invoke",value:function(e){var t=this;return this._isLocked?s.default.reject(I.isLock):this._invokeExecution(e).then(function(e){return t.clearRedoStack(),e})}},{key:"undo",value:function(){var e=this._undoStack.pop(),t=void 0;return e&&this._isLocked&&(this.pushUndoStack(e,!0),e=null),e?(this.isEmptyUndoStack()&&this._fire(M.EMPTY_UNDO_STACK),t=this._invokeUndo(e)):t=s.default.reject(I.undo),t}},{key:"redo",value:function(){var e=this._redoStack.pop(),t=void 0;return e&&this._isLocked&&(this.pushRedoStack(e,!0),e=null),e?(this.isEmptyRedoStack()&&this._fire(M.EMPTY_REDO_STACK),t=this._invokeExecution(e)):t=s.default.reject(I.redo),t}},{key:"pushUndoStack",value:function(e,t){this._undoStack.push(e),t||this._fire(M.PUSH_UNDO_STACK)}},{key:"pushRedoStack",value:function(e,t){this._redoStack.push(e),t||this._fire(M.PUSH_REDO_STACK)}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fire(M.EMPTY_UNDO_STACK))}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fire(M.EMPTY_REDO_STACK))}}]),e}();e.exports=R},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var i=n(23),r=n(34),o=n(78);e.exports=function(e){return function(t,n,a){var s,u=i(t),c=r(u.length),l=o(a,c);if(e&&n!=n){for(;c>l;)if(s=u[l++],s!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var i=n(13),r=n(63),o=n(62),a=n(6),s=n(34),u=n(81),c={},l={},t=e.exports=function(e,t,n,f,h){var d,v,p,_,g=h?function(){return e}:u(e),y=i(n,f,t?2:1),m=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(d=s(e.length);d>m;m++)if(_=t?y(a(v=e[m])[0],v[1]):y(e[m]),_===c||_===l)return _}else for(p=g.call(e);!(v=p.next()).done;)if(_=r(p,y,v.value,t),_===c||_===l)return _};t.BREAK=c,t.RETURN=l},function(e,t,n){e.exports=!n(10)&&!n(27)(function(){return 7!=Object.defineProperty(n(19)("div"),"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var i=n(12);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,n){var i=n(11),r=n(3)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[r]===e)}},function(e,t,n){var i=n(6);e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&i(o.call(e)),t}}},function(e,t,n){"use strict";var i=n(68),r=n(31),o=n(20),a={};n(7)(a,n(3)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(a,{next:r(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var i=n(3)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o=[7],a=o[i]();a.next=function(){return{done:n=!0}},o[i]=function(){return a},e(o)}catch(e){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var i=n(4),r=n(33).set,o=i.MutationObserver||i.WebKitMutationObserver,a=i.process,s=i.Promise,u="process"==n(12)(a);e.exports=function(){var e,t,n,c=function(){var i,r;for(u&&(i=a.domain)&&i.exit();e;){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,i&&i.enter()};if(u)n=function(){a.nextTick(c)};else if(o){var l=!0,f=document.createTextNode("");new o(c).observe(f,{characterData:!0}),n=function(){f.data=l=!l}}else if(s&&s.resolve){var h=s.resolve();n=function(){h.then(c)}}else n=function(){r.call(i,c)};return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},function(e,t,n){var i=n(6),r=n(69),o=n(25),a=n(21)("IE_PROTO"),s=function(){},u="prototype",c=function(){var e,t=n(19)("iframe"),i=o.length,r="<",a=">";for(t.style.display="none",n(28).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(r+"script"+a+"document.F=Object"+r+"/script"+a),e.close(),c=e.F;i--;)delete c[u][o[i]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(s[u]=i(e),n=new s,s[u]=null,n[a]=e):n=c(),void 0===t?n:r(n,t)}},function(e,t,n){var i=n(16),r=n(6),o=n(72);e.exports=n(10)?Object.defineProperties:function(e,t){r(e);for(var n,a=o(t),s=a.length,u=0;s>u;)i.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var i=n(14),r=n(79),o=n(21)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),i(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){var i=n(14),r=n(23),o=n(57)(!1),a=n(21)("IE_PROTO");e.exports=function(e,t){var n,s=r(e),u=0,c=[];for(n in s)n!=a&&i(s,n)&&c.push(n);for(;t.length>u;)i(s,n=t[u++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var i=n(71),r=n(25);e.exports=Object.keys||function(e){return i(e,r)}},function(e,t,n){var i=n(7);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:i(e,r,t[r]);return e}},function(e,t,n){e.exports=n(7)},function(e,t,n){"use strict";var i=n(4),r=n(9),o=n(16),a=n(10),s=n(3)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:i[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var i=n(6),r=n(17),o=n(3)("species");e.exports=function(e,t){var n,a=i(e).constructor;return void 0===a||void 0==(n=i(a)[o])?t:r(n)}},function(e,t,n){var i=n(22),r=n(18);e.exports=function(e){return function(t,n){var o,a,s=String(r(t)),u=i(n),c=s.length;return u<0||u>=c?e?"":void 0:(o=s.charCodeAt(u),o<55296||o>56319||u+1===c||(a=s.charCodeAt(u+1))<56320||a>57343?e?s.charAt(u):o:e?s.slice(u,u+2):(o-55296<<10)+(a-56320)+65536)}}},function(e,t,n){var i=n(22),r=Math.max,o=Math.min;e.exports=function(e,t){return e=i(e),e<0?r(e+t,0):o(e,t)}},function(e,t,n){var i=n(18);e.exports=function(e){return Object(i(e))}},function(e,t,n){var i=n(15);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var i=n(24),r=n(3)("iterator"),o=n(11);e.exports=n(9).getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||o[i(e)]}},function(e,t,n){"use strict";var i=n(55),r=n(66),o=n(11),a=n(23);e.exports=n(29)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):"keys"==t?r(0,n):"values"==t?r(0,e[n]):r(0,[n,e[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t){},function(e,t,n){"use strict";var i,r,o,a=n(30),s=n(4),u=n(13),c=n(24),l=n(26),f=n(15),h=n(17),d=n(56),v=n(58),p=n(76),_=n(33).set,g=n(67)(),y="Promise",m=s.TypeError,b=s.process,k=s[y],b=s.process,C="process"==c(b),O=function(){},E=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[n(3)("species")]=function(e){e(O,O)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t}catch(e){}}(),w=function(e,t){return e===t||e===k&&t===o},T=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},S=function(e){return w(k,e)?new x(e):new r(e)},x=r=function(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw m("Bad Promise constructor");t=e,n=i}),this.resolve=h(t),this.reject=h(n)},j=function(e){try{e()}catch(e){return{error:e}}},P=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var i=e._v,r=1==e._s,o=0,a=function(t){var n,o,a=r?t.ok:t.fail,s=t.resolve,u=t.reject,c=t.domain;try{a?(r||(2==e._h&&I(e),e._h=1),a===!0?n=i:(c&&c.enter(),n=a(i),c&&c.exit()),n===t.promise?u(m("Promise-chain cycle")):(o=T(n))?o.call(n,s,u):s(n)):u(i)}catch(e){u(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&A(e)})}},A=function(e){_.call(s,function(){var t,n,i,r=e._v;if(M(e)&&(t=j(function(){C?b.emit("unhandledRejection",r,e):(n=s.onunhandledrejection)?n({promise:e,reason:r}):(i=s.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=C||M(e)?2:1),e._a=void 0,t)throw t.error})},M=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,i=0;n.length>i;)if(t=n[i++],t.fail||!M(t.promise))return!1;return!0},I=function(e){_.call(s,function(){var t;C?b.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})})},R=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw m("Promise can't be resolved itself");(t=T(e))?g(function(){var i={_w:n,_d:!1};try{t.call(e,u(L,i,1),u(R,i,1))}catch(e){R.call(i,e)}}):(n._v=e,n._s=1,P(n,!1))}catch(e){R.call({_w:n,_d:!1},e)}}};E||(k=function(e){d(this,k,y,"_h"),h(e),i.call(this);try{e(u(L,this,1),u(R,this,1))}catch(e){R.call(this,e)}},i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=n(73)(k.prototype,{then:function(e,t){var n=S(p(this,k));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?b.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&P(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),x=function(){var e=new i;this.promise=e,this.resolve=u(L,e,1),this.reject=u(R,e,1)}),l(l.G+l.W+l.F*!E,{Promise:k}),n(20)(k,y),n(75)(y),o=n(9)[y],l(l.S+l.F*!E,y,{reject:function(e){var t=S(this),n=t.reject;return n(e),t.promise}}),l(l.S+l.F*(a||!E),y,{resolve:function(e){if(e instanceof k&&w(e.constructor,this))return e;var t=S(this),n=t.resolve;return n(e),t.promise}}),l(l.S+l.F*!(E&&n(65)(function(e){k.all(e).catch(O)})),y,{all:function(e){var t=this,n=S(t),i=n.resolve,r=n.reject,o=j(function(){var n=[],o=0,a=1;v(e,!1,function(e){var s=o++,u=!1;n.push(void 0),a++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--a||i(n))},r)}),--a||i(n)});return o&&r(o.error),n.promise},race:function(e){var t=this,n=S(t),i=n.reject,r=j(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r&&i(r.error),n.promise}})},function(e,t,n){"use strict";var i=n(77)(!0);n(29)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=i(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){n(82);for(var i=n(4),r=n(7),o=n(11),a=n(3)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var c=s[u],l=i[c],f=l&&l.prototype;f&&!f[a]&&r(f,a,c),o[c]=o.Array}}]);