<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Default</title>
    <link href="css/tui-image-editor.css" rel="stylesheet" type="text/css">
    <!--[If lt IE 9]>
        <script type="text/javascript" src="libs/html5shiv-printshiv.min.js"></script>
        <script type="text/javascript" src="libs/json2.js"></script>
        <script type="text/javascript" src="libs/excanvas.js"></script>
    <![endif]-->

</head>
<body>
    <div>
        <a id="btn-download"><button>다운로드</button></a>
        <button id="btn-undo">Undo</button>
        <button id="btn-redo">Redo</button>
        <button id="btn-crop">Crop</button>
    </div>
    <div id="crop-submenu" style="display:none;">
        <button id="btn-applyCrop">apply</button>
        <button id="btn-cancelCrop">cancel</button>
    </div>
    <br>
    <div>
        <div id="uploader"></div>
        <div id="list">
            <ul id="files"></ul>
        </div>
    </div>
    <div id="editor" style="margin:auto;">
        <canvas></canvas>
    </div>
    <script type="text/javascript" src="libs/fabric.js"></script>
    <script type="text/javascript" src="libs/jquery.min.js"></script>
    <script type="text/javascript" src="libs/code-snippet.js"></script>
    <script type="text/javascript" src="libs/file-uploader.min.js"></script>
    <script type="text/javascript" src="js/image-editor.js"></script>
    <script type="text/javascript">
        // image editor
        var imageEditor = new tui.component.ImageEditor('#editor canvas');
        var eventNames = tui.component.ImageEditor.eventNames;

        // buttons
        var $cropSubMenu = $('#crop-submenu');
        var $downloadBtn = $('#btn-download');
        var $undoBtn = $('#btn-undo');
        var $redoBtn = $('#btn-redo');
        var $cropBtn = $('#btn-crop');
        var $applyCropBtn = $('#btn-applyCrop');
        var $cancelCropBtn = $('#btn-cancelCrop');

        /**
         * Image editor
         */
        imageEditor.loadImageFromURL('tree.jpg', './img/tree.jpg');

        imageEditor.on(eventNames.START_CROPPING, function() {
            $cropSubMenu.show();
        });
        imageEditor.on(eventNames.END_CROPPING, function() {
            $cropSubMenu.hide();
        });
        imageEditor.on(eventNames.EMPTY_UNDO_STACK, function() {
            $undoBtn.attr('disabled', true);
        });
        imageEditor.on(eventNames.PUSH_UNDO_STACK, function() {
            $undoBtn.attr('disabled', false);
        });
        imageEditor.on(eventNames.EMPTY_REDO_STACK, function() {
            $redoBtn.attr('disabled', true);
        });
        imageEditor.on(eventNames.PUSH_REDO_STACK, function() {
            $redoBtn.attr('disabled', false);
        });

        /**
         * Set event listeners
         */
        $downloadBtn.on('click', function () {
            this.download = imageEditor.getImageName();
            this.href = imageEditor.toDataURL();
        });
        $undoBtn.on('click', function() {
            imageEditor.undo()
        });
        $redoBtn.on('click', function() {
            imageEditor.redo()
        });
        $cropBtn.on('click', function() {
            imageEditor.startCropping()
        });
        $applyCropBtn.on('click', function() {
            imageEditor.endCropping(true);
        });
        $cancelCropBtn.on('click', function() {
            imageEditor.endCropping();
        });

        /**
         * tui-component-uploader
         */
        var uploader = new tui.component.Uploader({
            url: {
                send: 'http://10.77.29.126:4000/upload',
                remove: 'http://10.77.29.126:4000/remove'
            },
            formTarget: 'hiddenFrame',
            listInfo: {
                list: $('#files'),
                count: $(),
                size: $()
            }
        }, $('#uploader'));

        uploader.on('success', function(data) {
            var fileInfo = data.filelist[0],
                filename = fileInfo.name;

            imageEditor.loadImageFromURL(filename, fileInfo.path);
        })
    </script>
</body>
</html>
